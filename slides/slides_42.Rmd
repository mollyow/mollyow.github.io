---
title: 4.2 Experiments and Estimands
subtitle: PLSC30500, Fall 2021
author: 
  - co-taught by Molly Offer-Westort & Andy Eggers
  - .small-text[(This lecture with references to Gerber & Green (2012))]
output:
  xaringan::moon_reader:
    css: [default, robot, robot-fonts]
    nature:
      highlightStyle: atelier-lakeside-light
      highlightLines: yes
      countIncrementalSlides: no
    pandoc_args: --metadata-file=./common.yaml
    pdf_document:
      extra_dependencies: ["mathtools"]
---

```{r setup, include=FALSE}
library(tidyverse)
set.seed(60637)
```

```{css, echo=FALSE}
.small-output .remark-code{
  font-size: x-small;
}

# .show-only-last-code-result pre + pre:not(:last-of-type) code[class="remark-code"] {
#     display: none;
# }
```


# Estimation

---

## Estimand

The *estimand* is the parameter of interest--it is the quantity that we would like to know about.

--

For example, when we care about causal effects, the estimand may be:

 - the Average Treatment Effect (ATE)
 - the Average effect of Treatment on the Treated (ATT)
 - the Average effect of Treatment on the Control (ATC)

--

Why might these three quantities differ?

--

*Notational aside: we often denote the estimand with the greek letter $\theta$. Specific estimands may have conventional notations, such as $\mu$ for the mean or $\sigma$ for the standard deviation.*


---

## Estimator

An *estimator* is a function of the data we observe; it is an informed guess about the value of the estimand. 
--
Below, the estimator is the function $g(\cdot)$. 


$$
g(X_1, \dots, X_n)
$$


---

## Estimate

An *estimate* is what we calculate from our estimator with a specific set of data. Below, the estimate is the quantity $\hat{\theta}_n$. 

$$
\hat{\theta}_n = g(X_1, \dots, X_n)
$$

---


<!-- Suppose we are interested in the population mean, $\mu$. -->

<!-- - The population mean, $\mu$, is the estimand. -->
<!-- - We will use the sample mean, $\bar{X}_n$ as the estimator. -->
<!-- - Given some data that we observe $x_1, \dots, x_n$, we calculate an estimate, $\bar{x}_n$ -->


<!-- --- -->

## Bias of an estimator

The bias of an estimator is the expected difference between the estimate and the true value of the estimand. 

$$
\textrm{bias}(\hat{\theta}_n) = \textrm{E}[\hat\theta_n] - \theta
$$

--

An estimator is *unbiased* if

$$\textrm{E}[\hat\theta_n] = \theta$$

---

The estimator is a function of the data, and so whether or not the estimator is biased for our estimand *also depends on the data we see.*

--

In randomized experiments, we are in a special setting where get input on what data we observe. 


---

# Randomization

---

## Design


Gerber Green example:

--

|           | $Y_i(0)$ | $Y_i(1)$ | $\tau_i$ |
|-----------|:--------:|:--------:|:--------:|
| Village 1 |     ?    |    15    |     ?    |
| Village 2 |    15    |     ?    |     ?    |
| Village 3 |    20    |     ?    |     ?    |
| Village 4 |    20    |     ?    |     ?    |
| Village 5 |    10    |     ?    |     ?    |
| Village 6 |    15    |     ?    |     ?    |
| Village 7 |     ?    |    30    |     ?    |
|           |          |          |          |

---

## Design


Gerber Green example:

|           | $Y_i(0)$ | $Y_i(1)$ | $\tau_i$ |
|-----------|:--------:|:--------:|:--------:|
| Village 1 |     ?    |    15    |     ?    |
| Village 2 |    15    |     ?    |     ?    |
| Village 3 |    20    |     ?    |     ?    |
| Village 4 |    20    |     ?    |     ?    |
| Village 5 |    10    |     ?    |     ?    |
| Village 6 |    15    |     ?    |     ?    |
| Village 7 |     ?    |    30    |     ?    |
|**Average**| **16**   |  **22.5**|  **?**   |

---

Target estimand: ATE 

$$
\textrm{E}[\tau_i] = \textrm{E}[Y_i(1)] - \textrm{E}[Y_i(0)]
$$

--

Under random assignment where everyone has the same probability of being assigned treatment,

$$
\begin{align}
\textrm{E}[Y_i(1)|D_i = 1] &= \textrm{E}[Y_i(1)|D_i = 0]
\end{align}
$$

---

Target estimand: ATE 

$$
\textrm{E}[\tau_i] = \textrm{E}[Y_i(1)] - \textrm{E}[Y_i(0)]
$$


Under random assignment where everyone has the same probability of being assigned treatment,

$$
\begin{align}
\textrm{E}[Y_i(1)|D_i = 1] &= \textrm{E}[Y_i(1)|D_i = 0]  \\\\
& = \textrm{E}[Y_i(1)]
\end{align}
$$

--
And, 
$$
\begin{align}
\textrm{E}[Y_i(0)|D_i = 0] &= \textrm{E}[Y_i(1)|D_i = 1]
\end{align}
$$


---


Target estimand: ATE 

$$
\textrm{E}[\tau_i] = \textrm{E}[Y_i(1)] - \textrm{E}[Y_i(0)]
$$


Under random assignment where everyone has the same probability of being assigned treatment,

$$
\begin{align}
\textrm{E}[Y_i(1)|D_i = 1] &= \textrm{E}[Y_i(1)|D_i = 0]  \\\\
& = \textrm{E}[Y_i(1)]
\end{align}
$$

And, 
$$
\begin{align}
\textrm{E}[Y_i(0)|D_i = 0] &= \textrm{E}[Y_i(1)|D_i = 1] \\\\
& = \textrm{E}[Y_i(0)]
\end{align}
$$

---

We are then able to use our estimates of $\textrm{E}[Y_i(1)|D_i = 1]$ and $\textrm{E}[Y_i(0)|D_i = 0]$ to get an estimate of $\textrm{E}[\tau_i]$. 

--
This is the difference in means estimator:

$$
\hat\tau_{DM} = \frac{\sum_i^n Y_i D_i}{\sum_i^n D_i} - \frac{\sum_i^n Y_i (1-D_i)}{\sum_i^n (1-D_i)}
$$

--

The difference-in-means estimator is unbiased for the average treatment effect estimand, when treatment assignment is random. 

---
Plugging in from our example above, 

|           | $Y_i(0)$ | $Y_i(1)$ | $\tau_i$ |
|-----------|:--------:|:--------:|:--------:|
| Village 1 |     ?    |    15    |     ?    |
| Village 2 |    15    |     ?    |     ?    |
| Village 3 |    20    |     ?    |     ?    |
| Village 4 |    20    |     ?    |     ?    |
| Village 5 |    10    |     ?    |     ?    |
| Village 6 |    15    |     ?    |     ?    |
| Village 7 |     ?    |    30    |     ?    |
|**Average**| **16**   |  **22.5**| **6.5**  |


$$
\begin{align}
\hat\tau_{DM} & = \frac{\sum_i^n Y_i D_i}{\sum_i^n D_i} - \frac{\sum_i^n Y_i (1-D_i)}{\sum_i^n (1-D_i)}\\\\
& = \frac{15 +30}{2} - \frac{15 + 20 + 20 + 10 + 15}{5}\\\\
& = 6.5
\end{align}
$$


---

Considering some real data, we'll look at

*Butler, D. M., & Broockman, D. E. (2011). Do politicians racially discriminate against constituents? A field experiment on state legislators*

Data is available at the Yale ISPS data archive: isps.yale.edu/research/data

```{r, message=FALSE}
df <- read_csv('../data/legislators_email/Butler_Broockman_AJPS_2011_public_csv.csv')
```


```{r}
head(df)
```

---


### Description

*Emails are sent to state legislators. We signaled the race of the email sender by randomizing whether the email was signed by and sent from an email account with the name Jake Mueller or the name DeShawn Jackson.*

--

Treatment is 1 if the sender was DeShawn Jackson, and 0 if Jake Mueller. 

```{r}
table(df$treat_deshawn)
```

The primary outcome is whether legislators replied at all. 

```{r}
table(df$reply_atall)
```

---

To get the difference-in-means estimate of the ATE, 

```{r}
Y1 <- filter(df, treat_deshawn == 1) %>% pull(reply_atall)
Y0 <- filter(df, treat_deshawn == 0) %>% pull(reply_atall)

head(Y1)
head(Y0)
```

--

```{r}
mean(Y1) - mean(Y0)
```


Legislators were 1.7 percentage points less likely to reply to an email if the sender was identified as DeShawn Jackson as compared to Jake Mueller. 

---

The `estimatr` package produces a difference-in-means estimate for us; the standard errors give us information about how precise we think the point estimate is--we'll come back to these later. 


```{r}
library(estimatr)

difference_in_means(reply_atall ~ treat_deshawn, data = df)
```


---

We can also look at conditional treatment effects. Here, we can condition on whether the legislator receiving the email was a Democrat vs. Republican. 

$$\textrm{E}[Y_i(1) - Y_i(0)|\textrm{party} = D]$$

```{r}
Y1D <- filter(df, treat_deshawn == 1, leg_party == 'D') %>% pull(reply_atall)
Y0D <- filter(df, treat_deshawn == 0, leg_party == 'D') %>% pull(reply_atall)

mean(Y1D) - mean(Y0D)
```

--

$$\textrm{E}[Y_i(1) - Y_i(0)|\textrm{party} = R]$$

```{r}
Y1R <- filter(df, treat_deshawn == 1, leg_party == 'R') %>% pull(reply_atall)
Y0R <- filter(df, treat_deshawn == 0, leg_party == 'R') %>% pull(reply_atall)

mean(Y1R) - mean(Y0R)
```

--
Democrats are *more* likely to respond to an email if the sender was identified as DeShawn Jackson as compared to Jake Mueller; whereas Republicans were *less* likely to respond. 


